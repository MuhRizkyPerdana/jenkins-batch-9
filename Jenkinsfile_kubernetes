pipeline {
    agent {
        label 'fire'
    }
    stages {
        stage ('build') {
            steps {
                echo "Build App"
                sh 'docker build -t gcr.io/studi-devops-370205/studidevsecops:1 .'
            }
        }
        stage ('Push to GCR') {
            environment {
                GCP_REGISTRY = credentials('gcp_service_account_storage')
            }
            steps {
                echo "push to gcr"
                sh 'cat "$GCP_REGISTRY" | docker login -u _json_key --password-stdin https://gcr.io'
                sh 'docker push gcr.io/studi-devops-370205/studidevsecops:1'
            }
        }
    }
}
